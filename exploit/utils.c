
#include "utils.h"

int avud_fd = -1;

void print_array(ull * array, int array_size){
	for(int i = 0;i < array_size; i++){
		printf("[%d] - 0x%016llx\n",i,array[i]);
	}
}

int open_avud(){
	avud_fd = open("/dev/avud", O_RDWR);
	if (avud_fd < 0){
		printf("[!] Failed to open AVUD: 0x%lx!\n",avud_fd);
		exit(-1);
	} else {
        puts("[*] Opened kryptor AVUD!");
    }
}

avud_request * alloc_request(){
	avud_request * t = malloc(sizeof(avud_request));
	memset(t,0,sizeof(avud_request));
	if(t == NULL){
		puts("[!] OOM, exiting");
		exit(-1);
	}
	return t;
}

char * alloc(int size){
	char * temp = malloc(size);
	if(!temp){
		printf("[!] OUT OF MEMORY!\n");
		exit(-2);
	}
	return temp;
}

int avud_ioctl(avud_request * req, unsigned int cmd){
	if(avud_fd == -2) return -2;
	return ioctl(avud_fd, cmd, req);
}

int stack_BOF_request(avud_request * req){
	return avud_ioctl(req, IOCTL_BOF_STACK);
}

int stack_OOBR_request(avud_request * req){
	return avud_ioctl(req, IOCTL_OOBR_STACK);
}

int heap_BOF_request(avud_request * req){
	return avud_ioctl(req, IOCTL_BOF_HEAP);
}